# 총에 맞은 대상의 체력 감소 기능

1. [적 캐릭터 생성](#적-캐릭터-생성)
2. [적 캐릭터의 체력(HP)](#적-캐릭터의-채력-설정)
3. [총에 맞면 HP가 줄어드는 기능](#적-캐릭터가-총에-맞으면-체력이-줄어들게-하기)
4. [HP의 시각화](#적-캐릭터-체력-시각화)

<br>

## 적 캐릭터 생성

- Player 캐릭터 Ctrl + D 로 복제(Enemy)
- Player, PlayerFire, Ridgbody 컴포넌트, 자식 오브젝트 Main Camera 삭제

<br>

## 적 캐릭터의 체력 설정

적 캐릭터의 최대 HP를 100으로 설정하고 총에 맞을 때마다 줄어들도록 구현

<br>

- 새로운 스크립트 생성(Enemy) &rarr; Enemy 오브젝트에 해당 스크립트 컴포넌트 부여
- "Enemy" 태그 생성 후 Enemy 오브젝트에 태그 달기

<br>

__Enemy 스크립트__|
|:---:|

```C#
using UnityEngine;

public class Enemy : MonoBehaviour
{
    // 적의 체력
    public float hp = 100;

    // 공격 받는 기능
    void Damaged(float damage)
    {
        // 공격 받은 데미지 만큼 체력 감소
        hp -= damage;
    }

    // Start is called once before the first execution of Update after the MonoBehaviour is created
    void Start()
    {
        
    }

    // Update is called once per frame
    void Update()
    {
        
    }
}
```

<br>

## 적 캐릭터가 총에 맞으면 체력이 줄어들게 하기

__PlayerFire 스크립트__|
|:---:|

```C#
using UnityEngine;

public class PlayerFire : MonoBehaviour
{
    // 총 효과 프리팹을 담아둘 변수
    public GameObject shootEffectPref;

    // Start is called once before the first execution of Update after the MonoBehaviour is created
    void Start()
    {
        // 마우스 커서 안 보이게
        Cursor.visible = false;

        // 마우스 커서가 게임 화면을 벗어나지 못하도록 잠금
        Cursor.lockState = CursorLockMode.Confined;
    }

    // Update is called once per frame
    void Update()
    {
        // 마우스 좌클릭을 누르는 순간
        if (Input.GetMouseButtonDown(0))
        {
            // 화면 가운데에서 시작하는 Ray 생성
            Ray ray = Camera.main.ViewportPointToRay(new Vector2(0.5f, 0.5f));

            // Ray에 맞은 물체를 담아둘 변수
            RaycastHit hit;

            // Ray를 발사하고, Ray에 맞은 물체는 hit에 저장
            // 맞은 물체가 있을 때만
            if (Physics.Raycast(ray, out hit))
            {
                // // 맞은 물제의 이름 출력
                // print(hit.transform.name);

                // 맞은 위치에, 맞은 표면의 수직이 되는 각도로 총 효과 프리팹의 복사본 생성
                GameObject shootEffect = Instantiate(shootEffectPref, hit.point + hit.normal * 0.01f, Quaternion.LookRotation(hit.normal));

                // 총알 자국을 맞은 오브젝트의 자식으로 설정
                shootEffect.transform.SetParent(hit.transform);

                // Ray에 맞은 물체가 적이라면
                if (hit.transform.tag == "Enemy")
                {
                    // 적에게 10만큼 공격 받으라고 전달
                    hit.transform.SendMessage("Damaged", 10);
                }
            }

        }
    }
}
```

- `SendMessage()`
  - 다른 함수를 직접 호출하지 않고 간접적으로 호출
  - 호출하는 함수가 public이 아니어도 호출 가능
 
<br>

https://github.com/user-attachments/assets/66be439a-c2f3-4315-b727-1571b744a2a5

<br>

## 적 캐릭터 체력 시각화

Enemy 오브젝트 머리 위에 HP 상태바 추가
- Slider 사용
- 화면 좌표가 아닌 게임 속 세상의 좌표(월드 좌표)에 배치해야 함

<br>

새로운 Canvas 추가(EnemyCanvas)|<img width="458" height="80" alt="스크린샷 2025-10-09 오후 6 44 56" src="https://github.com/user-attachments/assets/09c7045b-0448-4e7b-a223-24cbc9145cc7" />
|:---:|:---:|
Enemy 오브젝트의 자식으로 설정 후 위치 조정|<img width="738" height="282" alt="스크린샷 2025-10-09 오후 6 48 06" src="https://github.com/user-attachments/assets/698343ca-33ac-47a0-b32f-c7fd2a1b3973" />
Rotation Y축을 180으로 설정한 이유|기본 오브젝트의 방향과 UI 오브젝트의 방향이 반대라서|
EnemyCanvas의 자식 오브젝트로 Slider(HpBarSlider 추가), 너무 큼|<img width="869" height="365" alt="스크린샷 2025-10-09 오후 7 20 37" src="https://github.com/user-attachments/assets/50dff798-dd4a-4b28-b4f2-cf5564c5fc50" />
HpBarSlider 크기 및 위치 조절|<img width="449" height="196" alt="스크린샷 2025-10-09 오후 8 04 30" src="https://github.com/user-attachments/assets/c23eb2ae-c240-4257-95c4-1e0505c1c740" />
월드 좌표로 옮길 때는 Scale 조절|다른 좌표를 옮길 때는 Width, Height 조절|
HpBarslider value 1로 해도 꽉 안차짐|<img width="1315" height="796" alt="스크린샷 2025-10-09 오후 8 15 29" src="https://github.com/user-attachments/assets/f8845bfb-31c1-47d4-b76d-a5b32905f759" />
Fill Area의 Left, Top, Right, Bottom을 0으로 해야함|<img width="742" height="324" alt="스크린샷 2025-10-09 오후 9 49 20" src="https://github.com/user-attachments/assets/944d92c1-e7bd-4104-8567-cca49b2e1f8c" />
<img width="741" height="322" alt="스크린샷 2025-10-09 오후 9 50 27" src="https://github.com/user-attachments/assets/4ce95eaa-82e5-44b1-8a01-0d32c806b1ac" />|<img width="585" height="367" alt="스크린샷 2025-10-09 오후 9 50 39" src="https://github.com/user-attachments/assets/2c4447d0-2449-4418-bcd8-e2d2bc5116b7" />

Enemy 스크립트|
|:---:|

```C#
using UnityEngine;
using UnityEngine.UI;

public class Enemy : MonoBehaviour
{
    // 적의 체력바
    public Slider hpBar;
    // 적의 체력
    public float hp = 100;

    // 공격 받는 기능
    void Damaged(float damage)
    {
        // 공격 받은 데미지 만큼 체력 감소
        hp -= damage;

        // 감소한 체력을 체력바에 표시
        hpBar.value = hp;
    }

    // Start is called once before the first execution of Update after the MonoBehaviour is created
    void Start()
    {
        
    }

    // Update is called once per frame
    void Update()
    {
        
    }
}
```

<img width="1326" height="790" alt="스크린샷 2025-10-09 오후 10 29 42" src="https://github.com/user-attachments/assets/c729b024-de98-4642-b1dc-fa841bdc0272" />

### 카메라와 방향 맞추기

슬라이더가 UI라서 두께가 없기 때문에 옆에서 보면 제대로 보이지 않아서 플레이어가 바라보는 방향을 기준으로 똑같이 보이게끔 설정

- Billboard 스크립트 생성 후 EnemyCanvas에 컴포넌트로 추가

Billboard 스크립트|
|:---:|
```C#
using UnityEngine;

public class Billboard : MonoBehaviour
{
    // Update is called once per frame
    void Update()
    {
        // 카메라가 바라보는 방향대로 내가 바라보는 방향 설정
        transform.forward = Camera.main.transform.forward;        
    }
}
```

https://github.com/user-attachments/assets/dcbe9daf-1fce-4899-9467-3285f57cbf5c

<br>

## 체력바 옆에 짜투리 남는 거 수정

수정 전 -10|수정 전 -100
|:---:|:---:|
<img width="585" height="425" alt="스크린샷 2025-10-10 오전 4 02 55" src="https://github.com/user-attachments/assets/7c967649-59e2-46b5-9037-13e78d52fcbb" />|<img width="585" height="441" alt="스크린샷 2025-10-10 오전 4 03 16" src="https://github.com/user-attachments/assets/fc9af43f-030d-42c8-9775-3057dab1a959" />

Slider &rarr; Fill Area &rarr; Fill
- Left, Right -5로 설정되어 있는 것 0으로 변경

수정 전|<img width="737" height="303" alt="스크린샷 2025-10-10 오전 4 07 25" src="https://github.com/user-attachments/assets/bc11f819-d2c9-4204-8cd3-046481f7fa4a" />
|:---:|:---:|
수정 후|<img width="738" height="301" alt="스크린샷 2025-10-10 오전 4 07 42" src="https://github.com/user-attachments/assets/407cdc55-12dc-4d57-9da7-e6d6f65886a8" />


수정 후 -10| 수정 후 -100
|:---:|:---:|
<img width="586" height="438" alt="스크린샷 2025-10-10 오전 4 09 00" src="https://github.com/user-attachments/assets/d1f708e7-e238-499d-b5af-84f6003f966f" />|<img width="584" height="451" alt="스크린샷 2025-10-10 오전 4 10 53" src="https://github.com/user-attachments/assets/fa1e1033-5627-487e-b76b-5db3e15bef72" />
