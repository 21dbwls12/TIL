qo# 플레이어 체력 상태바 구현

적 캐릭터가 공격을 받으면 HP가 줄어들어야 함

<br>

## 체력 구현

PlayerHP 스크립트 Player 오브젝트에 컴포넌트로 추가


PlayerHP 스크립트|
|:---:|

```C#
using UnityEngine;

public class PlayerHP : MonoBehaviour
{
    // 플레이어의 체력
    float hp = 100;

    // Start is called once before the first execution of Update after the MonoBehaviour is created
    void Start()
    {
        
    }

    // Update is called once per frame
    void Damaged(float damage)
    {
        // 공격 받은 데미지만큼 체력 감소
        hp -= damage;   
    }
}
```

Enemy 스크립트|
|:---:|

```C#
// Attack() 함수 밑에 추가 작성

// 공격 애니메이션 중간에 호출
void RealAttack()
{
    // 플레이어에게 10만큼 공격 받으라고 전달
    player.SendMessage("Damaged", 10);
}
```

<br>

### 적의 공격에 의한 체력 감소 타이밍

__애니메이션 이벤트(Animation Event)__ 사용해서 공격 애니메이션 실행 중에 RealAttack() 함수 호출

- 읽기 전용 상태(fbx파일)의 애니메이션은 애니메이션 이벤트 사용 불가
  

<br>

#### 읽기 전용 상태의 애니메이션 수정

수정 불가능한 파일|<img width="166" height="97" alt="스크린샷 2025-10-14 오후 4 15 06" src="https://github.com/user-attachments/assets/0bbd3c44-21ca-4016-ade0-522d7ad1bb06" />
|:---:|:---:|
Attack01 파일(피라미드 아이콘) Ctrl + D로 복제|<img width="170" height="133" alt="스크린샷 2025-10-14 오후 4 19 43" src="https://github.com/user-attachments/assets/edd4bf08-7e6f-43e3-97a6-1d49a5f43fab" />
6.Animations 폴더로 이동|<img width="116" height="65" alt="스크린샷 2025-10-14 오후 4 32 48" src="https://github.com/user-attachments/assets/035955e4-a7ab-483d-a34f-e4d04ee5a67c" />
Enemy 컨트롤러의 공격 모션을 원래의 Attack01 &rarr; 복제한 Attack01로 변경|<img width="469" height="350" alt="스크린샷 2025-10-14 오후 4 35 04" src="https://github.com/user-attachments/assets/a49df894-920c-4ebc-939d-7a0a6a94fa76" />
원래 공격 모션 파일(Read-Only)|<img width="201" height="22" alt="스크린샷 2025-10-14 오후 4 38 39" src="https://github.com/user-attachments/assets/cc87e580-e791-44d6-b380-4b089f41b94d" />
복제한 공격 모션 파일(None)|<img width="201" height="30" alt="스크린샷 2025-10-14 오후 4 39 00" src="https://github.com/user-attachments/assets/02762a39-404a-4574-bd75-4743a19459a0" />

<br>

#### 체력 타이밍

이벤트 추가 아이콘|<img width="26" height="23" alt="스크린샷 2025-10-14 오후 6 09 10" src="https://github.com/user-attachments/assets/35873cd5-5ac2-47b1-ab75-449ec44602aa" />
|:---:|:---:|
이벤트에 RealAttack() 함수 호출 선택|<img width="1326" height="811" alt="스크린샷 2025-10-14 오후 6 14 08" src="https://github.com/user-attachments/assets/2634b3cc-8dbe-42d8-a379-1098762f9167" />

<img width="585" height="808" alt="스크린샷 2025-10-14 오후 6 23 01" src="https://github.com/user-attachments/assets/7759ff62-1eeb-4289-9755-b8ec6330affd" />

<br>

## 체력 시각화

UI &rarr; Slider
- 적 캐릭터 HP 상태바와 같이 속성 수정

```C#
using UnityEngine;
using UnityEngine.UI;

public class PlayerHP : MonoBehaviour
{
    // 플레이어의 체력
    public float hp = 100;
    // 플레이어의 체력바
    public Slider hpBar;

    // Start is called once before the first execution of Update after the MonoBehaviour is created
    void Start()
    {
        
    }

    // Update is called once per frame
    void Damaged(float damage)
    {
        // 공격 받은 데미지만큼 체력 감소
        hp -= damage;

        // 체력바에 체력 표시
        hpBar.value = hp;
    }
}
```

<img width="588" height="422" alt="스크린샷 2025-10-14 오후 3 13 27" src="https://github.com/user-attachments/assets/1fc0c822-b101-406c-a5f2-ac7a3b015330" />

<br>

## 적 캐릭터가 한번 공격받으면 다음 모션으로 넘어가지 않고 멈추는 현상 수정

https://github.com/user-attachments/assets/b4ad781f-868a-40d6-b22e-674276defc1d

Enemy 스크립트|
|:---:|

```C#
// 피격 애니메이션이 끝나면 호출
void DamagedEnd()
{
    // 기본 상태로 전환
    eState = EnemyState.Idle;
}
```
Start() 함수 위에 추가 작성 &rarr; GetHit 애니메이션 중간에 RealAttack() 함수 호출했던 것과 같은 방법으로 DamagedEnd() 함수 호출

<img width="1323" height="807" alt="스크린샷 2025-10-14 오후 7 01 19" src="https://github.com/user-attachments/assets/a4166697-5194-4793-83ba-8e0e3e68ec8b" />

https://github.com/user-attachments/assets/77e82517-ec2c-44c0-af39-ab67e112e7c3

<br>

## 플레이어 캐릭터 피격, 죽음 모션 적용

PlayerHP 스크립트|
|:---:|

```C#
using UnityEngine;
using UnityEngine.UI;

public class PlayerHP : MonoBehaviour
{
    // 플레이어의 체력
    public float hp = 100;
    // 플레이어의 체력바
    public Slider hpBar;

    // 플레이어의 Animator 컴포넌트
    Animator anim;

    // Start is called once before the first execution of Update after the MonoBehaviour is created
    void Start()
    {
        anim = GetComponent<Animator>();
    }

    // Update is called once per frame
    void Damaged(float damage)
    {
        // 공격 받은 데미지만큼 체력 감소
        hp -= damage;

        // 체력바에 체력 표시
        hpBar.value = hp;

        // 체력이 남아있다면
        if (hp > 0)
        {
            // 피격 애니메이션 실행
            anim.SetTrigger("damaged");
        }
        // 체력이 남아있지 않다면
        else
        {
            // 죽음 애니메이션 실행
            anim.SetTrigger("dead");

            // 플레이어의 기능 중단
            GetComponent<Player>().enabled = false;
            GetComponent<PlayerFire>().enabled = false;
            GetComponentInChildren<CamerRotate>().enabled = false;

            // 게임 내의 모든 적의 기능 중단
            // 적 캐릭터가 여러명일 경우 대비
            // 모든 적 캐릭터의 컴포넌트를 가져와 배열로 저장 후 비활성화
            Enemy[] enemies = FindObjectsByType<Enemy>(FindObjectsSortMode.None);
            foreach (var enemy in enemies)
            {
                enemy.enabled = false;
            }
        }
    }
}
```

https://github.com/user-attachments/assets/001672c3-68a4-403b-9b2d-5d206fd3fe45


<br>

--------------

<br>

# 알파 버전 완성

다음에는 베타 버전 시작
