# 애니메이션

## 플레이어 캐릭터

에셋에 남겨둔 애니메이션; 기본, 이동, 점프, 공격, 피격, 죽음

<img width="147" height="115" alt="스크린샷 2025-10-11 오후 4 58 02" src="https://github.com/user-attachments/assets/c2ab861a-e021-4134-b598-41bbce6a2caf" />

애니메이터 컨트롤러: 애니메이션 사이에 구조를 만들고 조건에 따라 전환|
|:---:|
<img width="793" height="604" alt="스크린샷 2025-10-11 오후 4 58 58" src="https://github.com/user-attachments/assets/b90d6ab8-df8f-4d8a-a02e-170c23343e6b" />|
<img width="146" height="36" alt="스크린샷 2025-10-11 오후 5 00 08" src="https://github.com/user-attachments/assets/d931425f-b7f3-49d5-b9ca-4f77a6fb29e3" />|
<img width="1323" height="789" alt="스크린샷 2025-10-11 오후 5 44 27" src="https://github.com/user-attachments/assets/a485ac38-1afc-4f8e-bdaf-0d759513e7ea" />|

사용할 애니메이션 드래그하고 정리|<img width="1084" height="606" alt="스크린샷 2025-10-11 오후 5 47 49" src="https://github.com/user-attachments/assets/32d606cd-f1b8-4bc7-8bdf-f0cdb9345c2f" />
|:---:|:---:|
초록색 Entry와 연결된게 제일 먼저 실행되는 애니메이션|<img width="459" height="204" alt="스크린샷 2025-10-11 오후 6 57 32" src="https://github.com/user-attachments/assets/731680ec-c440-4583-820a-c6ca3c153311" />
Player의 Animator 컴포넌트의 Controller에 드래그|<img width="724" height="770" alt="스크린샷 2025-10-11 오후 6 59 35" src="https://github.com/user-attachments/assets/28156a8c-c399-4fdf-b3f2-d3c16d823a96" />

### 애니메이션 트랜지션(Transition) 설정

모든 State 사이에 구조를 만들고 조건에 따라 전환되도록 구현하는 연결선 == 트랜지션

State &rarr; Make Transition|<img width="460" height="275" alt="스크린샷 2025-10-11 오후 7 04 03" src="https://github.com/user-attachments/assets/44a3a1a8-5e09-4d21-8cd4-c4b762c584f4" />
|:---:|:---:|
<img width="289" height="171" alt="스크린샷 2025-10-11 오후 7 05 06" src="https://github.com/user-attachments/assets/bc7f2cc2-2309-4c83-bc68-c6e9d5c400ea" />|<img width="283" height="279" alt="스크린샷 2025-10-11 오후 7 04 52" src="https://github.com/user-attachments/assets/987240bb-8777-4305-8d35-a8b56b673d07" />

- Idle과 Run: 양방향으로 설정
- Idel, Run 제외 State: Any State와 연결
  - Any State와 연결되면 이전 상태의 종류와 상관없이 전환 가능

<img width="987" height="497" alt="스크린샷 2025-10-11 오후 7 37 04" src="https://github.com/user-attachments/assets/e2368ac0-80b2-47e5-8327-56ff88c21cda" />

<img width="948" height="788" alt="스크린샷 2025-10-11 오후 8 43 22" src="https://github.com/user-attachments/assets/eb04974d-e3c1-48e4-9b54-bf707eed5197" />

체크: 이전 상태가 종료되어야만 다음 상태로 전환|<img width="203" height="25" alt="스크린샷 2025-10-11 오후 8 44 23" src="https://github.com/user-attachments/assets/c02f5567-c151-4e4c-b93a-fe7333ce9224" />
|:---:|:---:|
체크 해제하면 뜨는 오류|<img width="469" height="40" alt="스크린샷 2025-10-11 오후 11 28 39" src="https://github.com/user-attachments/assets/139e56b6-6204-4a74-9932-64e7bc083d59" />
조건 추가하면 없어짐|<img width="459" height="74" alt="스크린샷 2025-10-11 오후 11 29 03" src="https://github.com/user-attachments/assets/f71fd2e2-1371-46ef-a215-f26cb2362932" />

<br>

### 조건 추가하기

1. 애니메이터창 &rarr; Parameters &rarr; 변수 생성  
   <img width="151" height="124" alt="스크린샷 2025-10-12 오전 12 59 15" src="https://github.com/user-attachments/assets/e076278a-fd57-46ae-a9aa-c74fb594672a" />
2. 자료형 선택  
   <img width="207" height="166" alt="스크린샷 2025-10-12 오전 1 00 07" src="https://github.com/user-attachments/assets/89431cf8-bb5d-4bcc-aea5-3aae8f23030d" />
3. 변수명 변경  
   <img width="153" height="86" alt="스크린샷 2025-10-12 오전 1 00 37" src="https://github.com/user-attachments/assets/c441922a-7aed-4518-9b2b-6799742c55d2" />
4. 코드 수정
   ```C#
   using UnityEngine;

   public class Player : MonoBehaviour
   {
       // 이동 속도
       public float moveSpeed;
       // 회전 속도
       public float rotateSpeed;
       // 점프하는 힘
       public float jumpPower;
  
       // 점프환 횟수
       int jumpCount;
  
       // 플레이어의 Rigidbody 컴포넌트
       Rigidbody rb;
       // 플레이어의 Animator 컴포넌트
       Animator anim;
  
       // Start is called once before the first execution of Update after the MonoBehaviour is created
       void Start()
       {
           // 플레이어의 Rigidbody, Animator 컴포넌트 가져와서 저장
           rb = GetComponent<Rigidbody>();
           anim = GetComponent<Animator>();
       }
  
       // Update is called once per frame
       void Update()
       {
           // 방향키 또는 WASD키 입력을 숫자로 받아서 저장
           float h = Input.GetAxis("Horizontal");
           float v = Input.GetAxis("Vertical");
  
           // x축에는 h의 값을, z축에는 v의 값을 넣은 변수 생성
           // dir -> direction
           Vector3 dir = new Vector3(h, 0, v);
  
           // 모든 방향의 속도가 동일하도록 정규화
           dir.Normalize();
  
           // 플레이어를 기준으로 dir의 방향 조절
           dir = transform.TransformDirection(dir);
   
           // // 이동할 방향에 원하는 속도 곱하기 (모든 기기에서 동일한 속도)
           // transform.position += dir * moveSpeed * Time.deltaTime;
   
           // 물리 작용을 이용해 이동
           rb.MovePosition(rb.position + (dir * moveSpeed * Time.deltaTime));
  
           // 이동하는 속도를 velocity 변수에 할당
           // magnitude == dir에 있는 벡터의 크기와 방향 중 벡터의 크기
           anim.SetFloat("velocity", dir.magnitude);
   
           // Space 키를 누른 순간, 점프한 횟수가 2회 미만이라면
           if (Input.GetKeyDown(KeyCode.Space) && jumpCount < 2)
           {
               // 위로 순간적인 힘 발생
               rb.AddForce(Vector3.up * jumpPower, ForceMode.Impulse);
   
               // 점프할 때마다 점프 횟수 증가
               jumpCount++;
           }
  
           // 마우스의 좌우 움직임 입력을 숫자로 받아서 저장
           float mouseMoveX = Input.GetAxis("Mouse X");
   
           // 마우스가 움직인 만큼 Y축 회전
           transform.Rotate(0, mouseMoveX * rotateSpeed * Time.deltaTime, 0);
       }
  
       // 어떤 물체와 충돌을 시작한 순간에 호출
       private void OnCollisionEnter(Collision collision)
       {
           // 충돌한 물체의 태그가 "Ground"라면
           if (collision.gameObject.tag == "Ground")
           {
               // 점프 횟수 초기화
               jumpCount = 0;
           }
       }
   }
   ```
   - 애니메이터 컨트롤러에서 만든 변수는 직접 제어하지 못하고 Animator 컴포넌트를 통해서만 가능
     - Set 함수;SetFloat(), SetInteger(), Get 함수;GetFloat(), GetInteger()  
   멈추면 velocity == 0, 이동하면 velocity == 1
 
   https://github.com/user-attachments/assets/736a6a3d-eff7-4506-9f0b-ca620a16a222
5. 속도가 0.5보다 크면 달리는 모션으로 전환, 적으면 걷는 모션으로 전환
   <img width="1172" height="473" alt="스크린샷 2025-10-12 오전 2 00 24" src="https://github.com/user-attachments/assets/e56cac26-038f-4bd4-a04a-4ddb9586eb65" />|
   |:---:|
   <img width="1076" height="486" alt="스크린샷 2025-10-12 오전 2 00 52" src="https://github.com/user-attachments/assets/ffc5f188-8b15-44e9-b2bc-248c16b4a4c8" />|
   
   https://github.com/user-attachments/assets/022adddb-b214-4a24-b5de-c96008db51e9

6. 다른 모션을 위한 변수를 Parameters에서 Trigger 자료형으로 생성  
   <img width="165" height="223" alt="스크린샷 2025-10-12 오전 2 18 38" src="https://github.com/user-attachments/assets/839a31ca-400c-45df-bd85-959d0d9ac1f2" />
7. Any State에서 다른 모션으로 전환되는 트랜지션 선택 후 조건 추가
   Any State &rarr; 점프|Any State &rarr; 공격
   |:---:|:---:|
   <img width="471" height="508" alt="스크린샷 2025-10-12 오전 2 20 40" src="https://github.com/user-attachments/assets/d04ebb1d-2ab6-4d1f-8d09-85fbba2cca07" />|<img width="468" height="516" alt="스크린샷 2025-10-12 오전 2 20 59" src="https://github.com/user-attachments/assets/0c6ce434-f48f-4e08-880e-e14ee685e06a" />
   Any State &rarr; 피격|Any State &rarr; 사망
   <img width="471" height="545" alt="스크린샷 2025-10-12 오전 2 22 40" src="https://github.com/user-attachments/assets/b9a8ef41-338b-4b57-b916-c6df45a05ea4" />|<img width="467" height="546" alt="스크린샷 2025-10-12 오전 2 23 14" src="https://github.com/user-attachments/assets/87b1f161-6c2f-4cdd-997d-346d6af34fd3" />
8. 7번 모션 조건 발동 위한 코드 수정
   Player 스크립트
   |:---:|
   ```C#
   using UnityEngine;

   public class Player : MonoBehaviour
   {
       // 이동 속도
       public float moveSpeed;
       // 회전 속도
       public float rotateSpeed;
       // 점프하는 힘
       public float jumpPower;
  
       // 점프환 횟수
       int jumpCount;
  
       // 플레이어의 Rigidbody 컴포넌트
       Rigidbody rb;
       // 플레이어의 Animator 컴포넌트
       Animator anim;
  
       // Start is called once before the first execution of Update after the MonoBehaviour is created
       void Start()
       {
           // 플레이어의 Rigidbody, Animator 컴포넌트 가져와서 저장
           rb = GetComponent<Rigidbody>();
           anim = GetComponent<Animator>();
       }
  
       // Update is called once per frame
       void Update()
       {
           // 방향키 또는 WASD키 입력을 숫자로 받아서 저장
           float h = Input.GetAxis("Horizontal");
           float v = Input.GetAxis("Vertical");
  
           // x축에는 h의 값을, z축에는 v의 값을 넣은 변수 생성
           // dir -> direction
           Vector3 dir = new Vector3(h, 0, v);
  
           // 모든 방향의 속도가 동일하도록 정규화
           dir.Normalize();
  
           // 플레이어를 기준으로 dir의 방향 조절
           dir = transform.TransformDirection(dir);
   
           // // 이동할 방향에 원하는 속도 곱하기 (모든 기기에서 동일한 속도)
           // transform.position += dir * moveSpeed * Time.deltaTime;
   
           // 물리 작용을 이용해 이동
           rb.MovePosition(rb.position + (dir * moveSpeed * Time.deltaTime));
  
           // 이동하는 속도를 velocity 변수에 할당
           // magnitude == dir에 있는 벡터의 크기와 방향 중 벡터의 크기
           anim.SetFloat("velocity", dir.magnitude);
   
           // Space 키를 누른 순간, 점프한 횟수가 2회 미만이라면
           if (Input.GetKeyDown(KeyCode.Space) && jumpCount < 2)
           {
               // 위로 순간적인 힘 발생
               rb.AddForce(Vector3.up * jumpPower, ForceMode.Impulse);
   
               // 점프 애니메이션 실행
               anim.SetTrigger("jump");
   
               // 점프할 때마다 점프 횟수 증가
               jumpCount++;
           }
  
           // 마우스의 좌우 움직임 입력을 숫자로 받아서 저장
           float mouseMoveX = Input.GetAxis("Mouse X");
   
           // 마우스가 움직인 만큼 Y축 회전
           transform.Rotate(0, mouseMoveX * rotateSpeed * Time.deltaTime, 0);
       }
  
       // 어떤 물체와 충돌을 시작한 순간에 호출
       private void OnCollisionEnter(Collision collision)
       {
           // 충돌한 물체의 태그가 "Ground"라면
           if (collision.gameObject.tag == "Ground")
           {
               // 점프 횟수 초기화
               jumpCount = 0;
           }
       }
   }
   ```
   PlayerFire 스크립트|
   |:---:|
   ```C#
   using UnityEngine;

   public class PlayerFire : MonoBehaviour
   {
       // 총 효과 프리팹을 담아둘 변수
       public GameObject shootEffectPref;
   
       // 플레이어의 Animator 컴포넌트
       Animator anim;
  
       // Start is called once before the first execution of Update after the MonoBehaviour is created
       void Start()
       {
           anim = GetComponent<Animator>();
   
           // 마우스 커서 안 보이게
           Cursor.visible = false;
  
           // 마우스 커서가 게임 화면을 벗어나지 못하도록 잠금
           Cursor.lockState = CursorLockMode.Confined;
       }
  
       // Update is called once per frame
       void Update()
       {
           // 마우스 좌클릭을 누르는 순간
           if (Input.GetMouseButtonDown(0))
           {
               // 총 쏘는 애니메이션 실행
               anim.SetTrigger("shoot");
   
               // 화면 가운데에서 시작하는 Ray 생성
               Ray ray = Camera.main.ViewportPointToRay(new Vector2(0.5f, 0.5f));
   
               // Ray에 맞은 물체를 담아둘 변수
               RaycastHit hit;
   
               // Ray를 발사하고, Ray에 맞은 물체는 hit에 저장
               // 맞은 물체가 있을 때만
               if (Physics.Raycast(ray, out hit))
               {
                   // 맞은 위치에, 맞은 표면의 수직이 되는 각도로 총 효과 프리팹의 복사본 생성
                   GameObject shootEffect = Instantiate(shootEffectPref, hit.point + hit.normal * 0.01f, Quaternion.LookRotation(hit.normal));
   
                   // 총알 자국을 맞은 오브젝트의 자식으로 설정
                   shootEffect.transform.SetParent(hit.transform);
  
                   // Ray에 맞은 물체가 적이라면
                   if (hit.transform.tag == "Enemy")
                   {
                       // 적에게 10만큼 공격 받으라고 전달
                       hit.transform.SendMessage("Damaged", 10);
                   }
               }
           }
       }
   }
   ```

   https://github.com/user-attachments/assets/c6fbe4bc-bdb9-4258-8396-a7a105a1bcf3

9. 점프 후에 기본 상태로 전환이 잘 안되는 것 수정
   - Has Exit Time 체크가 해제되어 있기 때문  
     <img width="458" height="220" alt="스크린샷 2025-10-12 오전 2 48 39" src="https://github.com/user-attachments/assets/372f4614-1906-491f-96e8-e3d16acb7512" />
   - 점프 애니메이션은 Space를 누를 때 시작하고 땅에 닿을 때 끝나야 하기 때문에 bool 자료형 변수 필요  
     <img width="151" height="205" alt="스크린샷 2025-10-12 오전 2 50 41" src="https://github.com/user-attachments/assets/e2482380-d640-4345-ae85-af802d5bfc4c" />
     <img width="471" height="529" alt="스크린샷 2025-10-12 오전 2 56 48" src="https://github.com/user-attachments/assets/c6483601-1fa2-454e-b438-99f49ffffe29" />|<img width="471" height="477" alt="스크린샷 2025-10-12 오전 2 57 41" src="https://github.com/user-attachments/assets/0c5ccd63-799d-4ab6-8f9e-5b4ff134092d" />
     |:---:|:---:|
10. 코드 수정
    ```C#
    using UnityEngine;

    public class Player : MonoBehaviour
    {
        // 이동 속도
        public float moveSpeed;
        // 회전 속도
        public float rotateSpeed;
        // 점프하는 힘
        public float jumpPower;
    
        // 점프환 횟수
        int jumpCount;
    
        // 플레이어의 Rigidbody 컴포넌트
        Rigidbody rb;
        // 플레이어의 Animator 컴포넌트
        Animator anim;
    
        // Start is called once before the first execution of Update after the MonoBehaviour is created
        void Start()
        {
            // 플레이어의 Rigidbody, Animator 컴포넌트 가져와서 저장
            rb = GetComponent<Rigidbody>();
            anim = GetComponent<Animator>();
        }
    
        // Update is called once per frame
        void Update()
        {
            // 방향키 또는 WASD키 입력을 숫자로 받아서 저장
            float h = Input.GetAxis("Horizontal");
            float v = Input.GetAxis("Vertical");
    
            // x축에는 h의 값을, z축에는 v의 값을 넣은 변수 생성
            // dir -> direction
            Vector3 dir = new Vector3(h, 0, v);
    
            // 모든 방향의 속도가 동일하도록 정규화
            dir.Normalize();
    
            // 플레이어를 기준으로 dir의 방향 조절
            dir = transform.TransformDirection(dir);
    
            // // 이동할 방향에 원하는 속도 곱하기 (모든 기기에서 동일한 속도)
            // transform.position += dir * moveSpeed * Time.deltaTime;
    
            // 물리 작용을 이용해 이동
            rb.MovePosition(rb.position + (dir * moveSpeed * Time.deltaTime));
    
            // 이동하는 속도를 velocity 변수에 할당
            // magnitude == dir에 있는 벡터의 크기와 방향 중 벡터의 크기
            anim.SetFloat("velocity", dir.magnitude);
    
            // Space 키를 누른 순간, 점프한 횟수가 2회 미만이라면
            if (Input.GetKeyDown(KeyCode.Space) && jumpCount < 2)
            {
                // 위로 순간적인 힘 발생
                rb.AddForce(Vector3.up * jumpPower, ForceMode.Impulse);
    
                // 점프 애니메이션 실행
                anim.SetTrigger("jump");
                anim.SetBool("isJump", true);
    
                // 점프할 때마다 점프 횟수 증가
                jumpCount++;
            }
    
            // 마우스의 좌우 움직임 입력을 숫자로 받아서 저장
            float mouseMoveX = Input.GetAxis("Mouse X");
    
            // 마우스가 움직인 만큼 Y축 회전
            transform.Rotate(0, mouseMoveX * rotateSpeed * Time.deltaTime, 0);
        }
    
        // 어떤 물체와 충돌을 시작한 순간에 호출
        private void OnCollisionEnter(Collision collision)
        {
            // 충돌한 물체의 태그가 "Ground"라면
            if (collision.gameObject.tag == "Ground")
            {
                // 점프 횟수 초기화
                jumpCount = 0;
    
                // 점프 애니메이션 종료
                anim.SetBool("isJump", false);
            }
        }
    }
    ```
<br>

### 플레이어 캐릭터 모션

기본

https://github.com/user-attachments/assets/3e3b693b-4112-4e4a-9a1d-db59e282d7cf

이동

https://github.com/user-attachments/assets/0553ce76-91ab-4ce7-8964-f94f71cfa320

점프

https://github.com/user-attachments/assets/9228c138-99b8-49a1-81d8-dc69db2ad6dc

공격

https://github.com/user-attachments/assets/5707d5c9-3521-4dcb-8422-bd34ed097c55
