# 총알을 이용한 슈팅

1. [총알 제작](총알-제작)
2. [마우스 왼쪽 클릭 감지](슈팅-기능-구현)
3. [총알 생성 기능](Instantiate())
4. [총알 발사 기능](총알-발사)

<br>

## 총알 제작

3D Object &rarr; Sphere

### 프리팹(Prefab)

- 파일 형태로 재사용이 가능한 오브젝트
- 게임을 진행하는 도중에 생성되는 오브젝트
- 원본 파일 하나만 수정해도 연결된 모든 오브젝트가 변경됨
- 하이어라키창이 아닌 프로젝트창에서 관리

하이어라키창에서 프로젝트창으로 옮기면 파란색 정육면체로 바뀜
|:---:|
<img width="282" height="764" alt="스크린샷 2025-10-03 오전 1 12 45" src="https://github.com/user-attachments/assets/afe60bb5-da86-4b5d-b58c-f48388bb13b9" />|

수정이 필요할 땐 하이어라키창에 있는 오브젝트가 아닌 프로젝트창에 있는 오브젝트를 변경해야 함.
- 프로젝트창에 있는 오브젝트가 원본
- 하이어라키창에 있는 오브젝트를 변경하면 해당 장면의 특정 오브젝트만 변경됨.

<br>

## 슈팅 기능 구현

새로운 스크립트 생성(PlayerFire) &rarr; Player 오브젝트에 컴포넌트로 추가

### Bullet 오브젝트를 마우스 왼쪽 클릭이 감지되는 순간에 복제하여 게임안에 생성

```C#
using UnityEngine;

public class PlayerFire : MonoBehaviour
{
    // 총알 프리팹을 담아둘 변수
    public GameObject bulletPref;

    // Start is called once before the first execution of Update after the MonoBehaviour is created
    void Start()
    {
        
    }

    // Update is called once per frame
    void Update()
    {
        // 마우스 좌클릭을 누르는 순간
        if (Input.GetMouseButtonDown(0))
        {
            // 게임 안에 총알 프리팹의 복사본 생성
            Instantiate(bulletPref);
        }
    }
}
```

Bullet 오브젝트 드래그|플레이 후 좌클릭시 Bullet 오브젝트 생성됨
|:---:|:---:|
<img width="424" height="68" alt="스크린샷 2025-10-03 오전 1 29 26" src="https://github.com/user-attachments/assets/0aa5f460-4e54-4019-b2f6-02b635d0f8c5" />|<img width="864" height="812" alt="스크린샷 2025-10-03 오전 1 28 13" src="https://github.com/user-attachments/assets/9c1361ec-de2d-4b5d-8857-f1783500261e" />

<br>

#### `Instantiate()`

오브젝트를 복제하여 생성하는 기능

- Ìnstantiate(GameObject original) &rarr; original을 복제한 후 생성
- Ìnstantiate(GameObject original, Transform parent) &rarr; original을 복제한 후 parent의 자식으로 생성
- Ìnstantiate(GameObject original, Vector3 position, Quaternion rotation) &rarr; original을 복제한 후 position 위치에 rotation 각도로 생성

<br>

#### 프로젝트창에 있는 프리팹을 직접 인스펙터창으로 드래그 해도 되지만 불가능한 상왕에서는 코드 작성을 통해 자동으로 불러오기 가능

- `Resources.Load()`
  - 실수를 줄일 수 있고 편리
  - 더 많은 연산 발생
    - 꼭 필요한 경우에만 사용 권장


```C#
using UnityEngine;

public class PlayerFire : MonoBehaviour
{
    // 총알 프리팹을 담아둘 변수
    public GameObject bulletPref;

    // Start is called once before the first execution of Update after the MonoBehaviour is created
    void Start()
    {
        
    }

    // Update is called once per frame
    void Update()
    {
        // 마우스 좌클릭을 누르는 순간
        if (Input.GetMouseButtonDown(0))
        {
            // 게임 안에 리소스 폴더에서 불러오기한 총알 프리팹의 복사본 생성
            Instantiate(Resources.Load("Bullet"));
        }
    }
}
```

### 총알 생성 위치

총알은 플레이어 오브젝트 앞에 생성되어야 함.

```C#
using UnityEngine;

public class PlayerFire : MonoBehaviour
{
    // 총알 프리팹을 담아둘 변수
    public GameObject bulletPref;

    // Start is called once before the first execution of Update after the MonoBehaviour is created
    void Start()
    {
        
    }

    // Update is called once per frame
    void Update()
    {
        // 마우스 좌클릭을 누르는 순간
        if (Input.GetMouseButtonDown(0))
        {
            // // 게임 안에 리소스 폴더에서 불러오기한 총알 프리팹의 복사본 생성
            // // 실수를 줄일 수 있고 편리하나 연산이 더 많이 발생
            // // 꼭 필요한 경우에만 사용 권장
            // Instantiate(Resources.Load("Bullet"));

            // 게임 안에 총알 프리팹의 복사본 생성 (플레이어의 위치보다 1 앞에)
            Instantiate(bulletPref, transform.position + transform.forward, Quaternion.identity);
        }
    }
}
```

- 플레이어의 z축으로 +1만큼 이동한 위치에 생성
  - 플레이어의 위치 + `new Vector3(0,0,1)`
  - `Vector3.forward`
    - 절대적인 방향을 기준으로 +1 위치
  - `transform.forward`
    - 플레이어가 바라보는 방향을 기준으로 +1 위치
- `Quternion.identity`
  - 모든 축으로의 회전 각도가 0

`Vector3.forward`(시선 방향 서쪽)|`transform.forward`(시선 방향 서쪽)
|:---:|:---:|
<img width="571" height="402" alt="스크린샷 2025-10-03 오전 1 52 23" src="https://github.com/user-attachments/assets/7a6602c8-29e5-4da2-a441-eae2d9ffc868" />|<img width="575" height="406" alt="스크린샷 2025-10-03 오전 1 51 10" src="https://github.com/user-attachments/assets/6b70bed6-44f6-4940-9b3c-ea052da418ab" />

<br>

## 총알 발사

- 오브젝트 이동 기능 활용 가능
- 더 자연스럽게 순간적인 힘을 표현하기 위해 Rigidbody 컴포넌트 기능 활용

```C#
using UnityEngine;

public class PlayerFire : MonoBehaviour
{
    // 총알 프리팹을 담아둘 변수
    public GameObject bulletPref;

    // 총알 발사하는 힘
    public float firePower;

    // Start is called once before the first execution of Update after the MonoBehaviour is created
    void Start()
    {
        
    }

    // Update is called once per frame
    void Update()
    {
        // 마우스 좌클릭을 누르는 순간
        if (Input.GetMouseButtonDown(0))
        {
            // // 게임 안에 리소스 폴더에서 불러오기한 총알 프리팹의 복사본 생성
            // // 실수를 줄일 수 있고 편리하나 연산이 더 많이 발생
            // // 꼭 필요한 경우에만 사용 권장
            // Instantiate(Resources.Load("Bullet"));

            // 게임 안에 총알 프리팹의 복사본 생성 (플레이어의 위치보다 1 앞에)
            // forward -> z축 +1 (0,0,+1)
            // Vector3.forward -> 절대적인 방향을 기준으로 (0,0,+1)
            // transform.forward -> 오브젝트의 시선 방향을 기준으로 (0,0,+1)
            // Quaternion.identity -> 모든 축으로의 회전 각도 0
            // 생성 후 bullet 변수에 할당
            GameObject bullet = Instantiate(bulletPref, transform.position + transform.forward, Quaternion.identity);

            // 총알 복사본이 앞으로 날아가는 순간적인 힘 발생
            bullet.GetComponent<Rigidbody>().AddForce(transform.forward * firePower, ForceMode.Impulse);
        }
    }
}
```

Bullet 프리팹에 Rigidbody 컴포넌트 추가

https://github.com/user-attachments/assets/4ede77df-0c71-4b8b-a161-e5fbee22a3d4

<br>

## 마우스 커서 가리기

- 마우스를 움직이며 총을 쏘려고 할 때 게임 화면이 아닌 다른 곳이 클릭되어 게임이 멈춤
- 마우스 커서를 가려야 함

```C#
using UnityEngine;

public class PlayerFire : MonoBehaviour
{
    // 총알 프리팹을 담아둘 변수
    public GameObject bulletPref;

    // 총알 발사하는 힘
    public float firePower;

    // Start is called once before the first execution of Update after the MonoBehaviour is created
    void Start()
    {
        // 마우스 커서 안 보이게
        Cursor.visible = false;

        // 마우스 커서가 게임 화면을 벗어나지 못하도록 잠금
        Cursor.lockState = CursorLockMode.Confined;
    }

    // Update is called once per frame
    void Update()
    {
        // 마우스 좌클릭을 누르는 순간
        if (Input.GetMouseButtonDown(0))
        {
            // // 게임 안에 리소스 폴더에서 불러오기한 총알 프리팹의 복사본 생성
            // // 실수를 줄일 수 있고 편리하나 연산이 더 많이 발생
            // // 꼭 필요한 경우에만 사용 권장
            // Instantiate(Resources.Load("Bullet"));

            // 게임 안에 총알 프리팹의 복사본 생성 (플레이어의 위치보다 1 앞에)
            // forward -> z축 +1 (0,0,+1)
            // Vector3.forward -> 절대적인 방향을 기준으로 (0,0,+1)
            // transform.forward -> 오브젝트의 시선 방향을 기준으로 (0,0,+1)
            // Quaternion.identity -> 모든 축으로의 회전 각도 0
            // 생성 후 bullet 변수에 할당
            GameObject bullet = Instantiate(bulletPref, transform.position + transform.forward, Quaternion.identity);

            // 총알 복사본이 앞으로 날아가는 순간적인 힘 발생
            bullet.GetComponent<Rigidbody>().AddForce(transform.forward * firePower, ForceMode.Impulse);
        }
    }
}
```

플레이 모드에서 게임 화면을 한 번 클릭한 후에는 마우스 커서가 사라지고 Esc 키를 누르면 마우스가 보이는데 이거는 유니티 에디터에서만 가능
- 실제 게임에서 보이게 하려면 코드로 작성해야 함.

https://github.com/user-attachments/assets/7d6f0325-378a-4243-81c1-f537f59b9b47

### `CursorLockMode`

- `CursorLockMode.None` &rarr; 커서 잠금 모드 해제
- `CursorLockMode.Locked` &rarr; 커서의 위치를 게임 화면 중앙에 고정
- `CursorLockMode.Confined` &rarr; 커서가 화면 밖으로 벗어나지 못하도록 고정
