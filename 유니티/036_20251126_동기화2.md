## 플레이어 캐릭터 간의 공격

플레이어 캐릭터의 공격 기능이 다른 플레이어의 캐릭터에 영향을 주도록 구현

### 상대 플레이어 캐릭터 HP 상태바

Enemy 오브젝트의 자식 오브젝트 EnemyCanvas 복사|<img width="256" height="232" alt="스크린샷 2025-11-27 오전 12 05 07" src="https://github.com/user-attachments/assets/fdd30af6-dfd1-4d85-8687-b15d38cb8090" />
|:---:|:---:|
Player 프리팹 &rarr; 우클릭 &rarr; Paste As Child &rarr; 위치 수정|<img width="254" height="145" alt="스크린샷 2025-11-27 오전 12 15 21" src="https://github.com/user-attachments/assets/1b4f8ce1-ec88-4d0e-a830-2d050beda9e3" />

### 코드 수정

PlayScene에 있는 자신의 상태와 조준점을 확인할 수 있는 Canvas 오브젝트도 본인의 UI만 사용할 수 있도록 코드 수정

PlayerHP 스크립트|
|:---:|

```C#
(*)using Photon.Pun;
using UnityEngine;
using UnityEngine.UI;

public class PlayerHP : MonoBehaviour
{
    // 플레이어의 체력
    public float hp = 100;
    (*)// 플레이어의 체력바 (머리 위)
    (*)public Slider hpBar_World;

    // 플레이어의 Animator 컴포넌트
    Animator anim;

    (*)// 플레이어의 PhotonView 컴포넌트
    (*)PhotonView pv;
    (*)// 플레이어의 체력바 (화면)
    (*)Slider hpBar_Screen;

    // Start is called once before the first execution of Update after the MonoBehaviour is created
    void Start()
    {
        anim = GetComponent<Animator>();
        (*)pv = GetComponent<PhotonView>();

        (*)// 내 캐릭터일 때만 실행
        (*)if (pv.IsMine)
        (*){
            (*)// Canvas 검색해서 가져오기
            (*)Transform canvas = GameObject.Find("Canvas").transform;

            (*)// Canvas의 부모를 나로 설정
            (*)canvas.SetParent(transform);

            (*)// 화면 왼쪽 상단에 있는 플레이어의 체력바 가져오기
            (*)hpBar_Screen = canvas.GetComponentInChildren<Slider>();
        (*)}
    }

    // Update is called once per frame
    void Damaged(float damage)
    {
        // 공격 받은 데미지만큼 체력 감소
        hp -= damage;

        // 체력바에 체력 표시
        (*)hpBar_World.value = hp;

        (*)// 화면 체력바에 표시하는 건 내 캐릭터일 때만
        (*)if (pv.IsMine)
        (*){
            (*)hpBar_Screen.value = hp;
        (*)}

        // 체력이 남아있다면
        if (hp > 0)
        {
            // 피격 애니메이션 실행
            anim.SetTrigger("damaged");
        }
        // 체력이 남아있지 않다면
        else
        {
            // 죽음 애니메이션 실행
            anim.SetTrigger("dead");

            // 플레이어의 기능 중단
            GetComponent<Player>().enabled = false;
            GetComponent<PlayerFire>().enabled = false;
            GetComponentInChildren<CamerRotate>().enabled = false;

            // 더 이상 Enemy 오브젝트를 사용하지 않으므로 주석 처리
            // 게임 내의 모든 적의 기능 중단
            // 적 캐릭터가 여러명일 경우 대비
            // 모든 적 캐릭터의 컴포넌트를 가져와 배열로 저장 후 비활성화
            // Enemy[] enemies = FindObjectsByType<Enemy>(FindObjectsSortMode.None);
            // foreach (var enemy in enemies)
            // {
            //     enemy.enabled = false;
            // }
        }
    }
}
```

PlayerFire 스크립트|
|:---:|

```C#
using Photon.Pun;
using UnityEngine;

public class PlayerFire : MonoBehaviour
{
    // 총 효과 프리팹을 담아둘 변수
    public GameObject shootEffectPref;

    // 플레이어의 Animator 컴포넌트
    Animator anim;
    // 플레이어의 Photon View 컴포넌트
    PhotonView pv;

    // Start is called once before the first execution of Update after the MonoBehaviour is created
    void Start()
    {
        anim = GetComponent<Animator>();
        pv = GetComponent<PhotonView>();

        // 마우스 커서 안 보이게
        Cursor.visible = false;

        // 마우스 커서가 게임 화면을 벗어나지 못하도록 잠금
        Cursor.lockState = CursorLockMode.Confined;
    }

    // Update is called once per frame
    void Update()
    {
        // 마우스 좌클릭을 누르는 순간, 내 캐릭터일 때만
        if (Input.GetMouseButtonDown(0) && pv.IsMine)
        {
            // 총 쏘는 애니메이션 실행
            anim.SetTrigger("shoot");

            // 화면 가운데에서 시작하는 Ray 생성
            Ray ray = Camera.main.ViewportPointToRay(new Vector2(0.5f, 0.5f));

            // Ray에 맞은 물체를 담아둘 변수
            RaycastHit hit;

            // Ray를 발사하고, Ray에 맞은 물체는 hit에 저장
            // 맞은 물체가 있을 때만
            if (Physics.Raycast(ray, out hit))
            {
                // 맞은 위치에, 맞은 표면의 수직이 되는 각도로 총 효과 프리팹의 복사본 생성
                GameObject shootEffect = Instantiate(shootEffectPref, hit.point + hit.normal * 0.01f, Quaternion.LookRotation(hit.normal));

                // 총알 자국을 맞은 오브젝트의 자식으로 설정
                shootEffect.transform.SetParent(hit.transform);

                // Ray에 맞은 물체가 플레이어라면
                if (hit.transform.tag == "Player")
                {
                    // 플레이어에게 10만큼 공격 받으라고 전달
                    hit.transform.SendMessage("Damaged", 10);
                }

                (*)// Ray에 맞은 물체가 플레이어라면
                (*)if (hit.transform.tag == "Player")
                (*){
                    (*)// 플레이어에게 10만큼 공격 받으라고 전달
                    (*)hit.transform.SendMessage("Damaged", 10);
                (*)}
            }
        }
    }
}
```

Player 프리팹 태그 "Player"로 변경|<img width="749" height="770" alt="스크린샷 2025-11-27 오전 2 51 13" src="https://github.com/user-attachments/assets/d45e4ee2-1d42-4718-8b70-c21aae6963d3" />
|:---:|:---:|
Player 프리팹 Player Hp 컴포넌트 &rarr; Hp Bar_World 변수에 PlayerCanvas 오브젝트 하위 HpBarSlider 드래그|<img width="742" height="793" alt="스크린샷 2025-11-27 오전 2 55 42" src="https://github.com/user-attachments/assets/4b8b272e-9ba6-411b-ba28-5c8a9400cd67" />

현재까지는 내 화면에서만 적용되고 상대방의 게임화면에서는 내 캐릭터의 HP가 변경되지 않음

