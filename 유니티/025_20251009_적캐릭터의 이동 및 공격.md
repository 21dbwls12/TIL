# 적 캐릭터도 플레이어 캐릭터와 똑같이 움직일 수 있도록 인공지능 추가

1. [적 캐릭터의 상태를 나열하는 기능](#적-캐릭터의-상태)
2. [상태를 전환하는 기준](#상태를-전환하는-기준)
3. [기준에 따라 상태를 전환하는 기능](#조건에-따른-상태-전환)

<br>

## 유한 상태 머신(Finite State Machine)

유한한 개수의 상태를 조건에 따라 변화시키는 장치

- 적 캐릭터의 상태; 기본, 이동, 공격, 피격, 죽음
- 플레이어와 거리를 기준으로 상태가 바뀜, 플레이어의 공격도 상태 변화의 원인이 될 수 있음

기본| 약간 가까워지면-> |이동| 더 가까워지면-> |공격|
|:---:|:---:|:---:|:---:|:---:|
기본| <-많이 멀어지면  |이동| <-멀어지면      |공격|

플레이어의 공격이 들어오면-> |피격| 체력이 없다면-> |죽음|
|:---:|:---:|:---:|:---:|

<br>

## 적 캐릭터의 상태

- 열거형으로 상태 나열
- 현재 상태 저장할 변수 생성

Enemy 스크립트|
|:---:|

```C#
using UnityEngine;
using UnityEngine.UI;

public class Enemy : MonoBehaviour
{
    // 적이 가질 수 있는 상태 목록
    public enum EnemyState
    {
        Idle,    // 기본
        Walk,    // 이동
        Attack,  // 공격
        Damaged, // 피격
        Dead,    // 죽음
    }

    // 상태를 담아둘 변수를 만들고, 기본 상태로 시작
    public EnemyState eState = EnemyState.Idle;

    // 적의 체력바
    public Slider hpBar;
    // 적의 체력
    public float hp = 100;

    // 공격 받는 기능
    void Damaged(float damage)
    {
        // 공격 받은 데미지 만큼 체력 감소
        hp -= damage;

        // 감소한 체력을 체력바에 표시
        hpBar.value = hp;
    }

    // Start is called once before the first execution of Update after the MonoBehaviour is created
    void Start()
    {
        
    }

    // Update is called once per frame
    void Update()
    {
        
    }
}
```

<img width="457" height="446" alt="스크린샷 2025-10-10 오전 12 07 14" src="https://github.com/user-attachments/assets/9a900570-6f83-4415-a33a-285faa9c5351" />

<br>

## 상태를 전환하는 기준

기본 상태, 이동 상태, 공격 상태일 때 플레이어 캐릭터의 위치를 확인하고 거리에 따라 상태 전환

<br>

### 상태별 함수 생성

Enemy 스크립트|
|:---:|

```C#
using UnityEngine;
using UnityEngine.UI;

public class Enemy : MonoBehaviour
{
    // 적이 가질 수 있는 상태 목록
    public enum EnemyState
    {
        Idle,    // 기본
        Walk,    // 이동
        Attack,  // 공격
        Damaged, // 피격
        Dead,    // 죽음
    }

    // 상태를 담아둘 변수를 만들고, 기본 상태로 시작
    public EnemyState eState = EnemyState.Idle;

    // 적의 체력바
    public Slider hpBar;
    // 적의 체력
    public float hp = 100;

    // 공격 받는 기능
    void Damaged(float damage)
    {
        // 공격 받은 데미지 만큼 체력 감소
        hp -= damage;

        // 감소한 체력을 체력바에 표시
        hpBar.value = hp;
    }

    // Start is called once before the first execution of Update after the MonoBehaviour is created
    void Start()
    {

    }

    // Update is called once per frame
    void Update()
    {
        // 기본, 이동, 공격 상태일 때 할 일 나누기
        switch (eState)
        {
            case EnemyState.Idle: Idle(); break;
            case EnemyState.Walk: Walk(); break;
            case EnemyState.Attack: Attack(); break;
        }
    }

    // 기본 상태일 때 계속 할 일
    void Idle()
    {

    }

    // 이동 상태일 때 계속 할 일
    void Walk()
    {

    }

    // 공격 상태일 때 계속 할 일
    void Attack()
    {
        
    }
}
```

<br>

### 플레이어 캐릭터와의 거리 계산

Enemy 스크립트|
|:---:|

```C#
using UnityEngine;
using UnityEngine.UI;

public class Enemy : MonoBehaviour
{
    // 적이 가질 수 있는 상태 목록
    public enum EnemyState
    {
        Idle,    // 기본
        Walk,    // 이동
        Attack,  // 공격
        Damaged, // 피격
        Dead,    // 죽음
    }

    // 상태를 담아둘 변수를 만들고, 기본 상태로 시작
    public EnemyState eState = EnemyState.Idle;

    // 적의 체력바
    public Slider hpBar;
    // 적의 체력
    public float hp = 100;

    // 플레이어
    Transform player;
    // 플레이어와의 거리
    float distance;

    // 공격 받는 기능
    void Damaged(float damage)
    {
        // 공격 받은 데미지 만큼 체력 감소
        hp -= damage;

        // 감소한 체력을 체력바에 표시
        hpBar.value = hp;
    }

    // Start is called once before the first execution of Update after the MonoBehaviour is created
    void Start()
    {
        // Player 컴포넌트로 찾은 플레이어의 Transform 컴포넌트 가져오기
        // 책에서는 FindObjectOfType을 사용했는데 최신 버전은 사용불가라서 경고 뜨기에 경고에 나온 다른 함수로 대체
        player = FindFirstObjectByType<Player>().transform;
    }

    // Update is called once per frame
    void Update()
    {
        // 적과 플레이어 사이의 거리 계산
        distance = Vector3.Distance(transform.position, player.position);

        // 적과 플레이어 사이의 거리 출력
        print(distance);

        // 기본, 이동, 공격 상태일 때 할 일 나누기
        switch (eState)
        {
            case EnemyState.Idle: Idle(); break;
            case EnemyState.Walk: Walk(); break;
            case EnemyState.Attack: Attack(); break;
        }
    }

    // 기본 상태일 때 계속 할 일
    void Idle()
    {

    }

    // 이동 상태일 때 계속 할 일
    void Walk()
    {

    }

    // 공격 상태일 때 계속 할 일
    void Attack()
    {
        
    }
}
```

https://github.com/user-attachments/assets/8ff5615f-f84f-4305-a3d7-c99a17727136

<br>

#### 결정한 기준

- 8 이하일 때 플레이어를 따라오기
- 2 이하일 때 공격

<br>

## 조건에 따른 상태 전환

### 거리에 따른 상태 전환

Enemy 스크립트|
|:---:|

```C#
using UnityEngine;
using UnityEngine.UI;

public class Enemy : MonoBehaviour
{
    // 적이 가질 수 있는 상태 목록
    public enum EnemyState
    {
        Idle,    // 기본
        Walk,    // 이동
        Attack,  // 공격
        Damaged, // 피격
        Dead,    // 죽음
    }

    // 상태를 담아둘 변수를 만들고, 기본 상태로 시작
    public EnemyState eState = EnemyState.Idle;

    // 적의 체력바
    public Slider hpBar;
    // 적의 체력
    public float hp = 100;

    // 플레이어
    Transform player;
    // 플레이어와의 거리
    float distance;

    // 공격 받는 기능
    void Damaged(float damage)
    {
        // 공격 받은 데미지 만큼 체력 감소
        hp -= damage;

        // 감소한 체력을 체력바에 표시
        hpBar.value = hp;
    }

    // Start is called once before the first execution of Update after the MonoBehaviour is created
    void Start()
    {
        // Player 컴포넌트로 찾은 플레이어의 Transform 컴포넌트 가져오기
        // 책에서는 FindObjectOfType을 사용했는데 최신 버전은 사용불가라서 경고 뜨기에 경고에 나온 다른 함수로 대체
        player = FindFirstObjectByType<Player>().transform;
    }

    // Update is called once per frame
    void Update()
    {
        // 적과 플레이어 사이의 거리 계산
        distance = Vector3.Distance(transform.position, player.position);

        // 적과 플레이어 사이의 거리 출력
        print(distance);

        // 기본, 이동, 공격 상태일 때 할 일 나누기
        switch (eState)
        {
            case EnemyState.Idle: Idle(); break;
            case EnemyState.Walk: Walk(); break;
            case EnemyState.Attack: Attack(); break;
        }
    }

    // 기본 상태일 때 계속 할 일
    void Idle()
    {
        // 플레이어와의 거리가 8 이하라면
        if (distance <= 8)
        {
            // 이동 상태로 전환
            eState = EnemyState.Walk;
        }
    }

    // 이동 상태일 때 계속 할 일
    void Walk()
    {
        // 플레이어와의 거리가 8보다 크다면
        if (distance > 8)
        {
            eState = EnemyState.Idle;
        }
        // 플레이어와의 거리가 2 이하라면
        else if (distance <= 2)
        {
            // 공격 상태로 전환
            eState = EnemyState.Attack;
        }
    }

    // 공격 상태일 때 계속 할 일
    void Attack()
    {
        // 플레이어와의 거리가 2보다 크다면
        if (distance > 2)
        {
            // 이동 상태로 전환
            eState = EnemyState.Walk;
        }
    }
}
```

Idle|<img width="1326" height="841" alt="스크린샷 2025-10-10 오전 1 34 05" src="https://github.com/user-attachments/assets/a8120d50-ff97-4f75-8576-c6f5d82c5208" />
|:---:|:---:|
Walk|<img width="1325" height="835" alt="스크린샷 2025-10-10 오전 1 34 27" src="https://github.com/user-attachments/assets/c968651d-56ab-4f5b-a1ca-67fd43505460" />
Attack|<img width="1327" height="806" alt="스크린샷 2025-10-10 오전 1 34 39" src="https://github.com/user-attachments/assets/90617f89-ed07-468b-a48e-7afec3f8a1e9" />

<br>

### 피격에 따른 상태 전환

Enemy 스크립트|
|:---:|

```C#
using UnityEngine;
using UnityEngine.UI;

public class Enemy : MonoBehaviour
{
    // 적이 가질 수 있는 상태 목록
    public enum EnemyState
    {
        Idle,    // 기본
        Walk,    // 이동
        Attack,  // 공격
        Damaged, // 피격
        Dead,    // 죽음
    }

    // 상태를 담아둘 변수를 만들고, 기본 상태로 시작
    public EnemyState eState = EnemyState.Idle;

    // 적의 체력바
    public Slider hpBar;
    // 적의 체력
    public float hp = 100;

    // 플레이어
    Transform player;
    // 플레이어와의 거리
    float distance;

    // 공격 받는 기능
    void Damaged(float damage)
    {
        // 공격 받은 데미지 만큼 체력 감소
        hp -= damage;

        // 감소한 체력을 체력바에 표시
        hpBar.value = hp;

        // 체력이 남아있다면
        if (hp > 0)
        {
            // 피격 상태로 전환
            eState = EnemyState.Damaged;
        }
        // 체력이 남아있지 않다면
        else
        {
            // 죽음 상태로 전환
            eState = EnemyState.Dead;
        }
    }

    // Start is called once before the first execution of Update after the MonoBehaviour is created
    void Start()
    {
        // Player 컴포넌트로 찾은 플레이어의 Transform 컴포넌트 가져오기
        // 책에서는 FindObjectOfType을 사용했는데 최신 버전은 사용불가라서 경고 뜨기에 경고에 나온 다른 함수로 대체
        player = FindFirstObjectByType<Player>().transform;
    }

    // Update is called once per frame
    void Update()
    {
        // 적과 플레이어 사이의 거리 계산
        distance = Vector3.Distance(transform.position, player.position);

        // 기본, 이동, 공격 상태일 때 할 일 나누기
        switch (eState)
        {
            case EnemyState.Idle: Idle(); break;
            case EnemyState.Walk: Walk(); break;
            case EnemyState.Attack: Attack(); break;
        }
    }

    // 기본 상태일 때 계속 할 일
    void Idle()
    {
        // 플레이어와의 거리가 8 이하라면
        if (distance <= 8)
        {
            // 이동 상태로 전환
            eState = EnemyState.Walk;
        }
    }

    // 이동 상태일 때 계속 할 일
    void Walk()
    {
        // 플레이어와의 거리가 8보다 크다면
        if (distance > 8)
        {
            eState = EnemyState.Idle;
        }
        // 플레이어와의 거리가 2 이하라면
        else if (distance <= 2)
        {
            // 공격 상태로 전환
            eState = EnemyState.Attack;
        }
    }

    // 공격 상태일 때 계속 할 일
    void Attack()
    {
        // 플레이어와의 거리가 2보다 크다면
        if (distance > 2)
        {
            // 이동 상태로 전환
            eState = EnemyState.Walk;
        }
    }
}
```

Damaged|<img width="1325" height="803" alt="스크린샷 2025-10-10 오전 1 48 27" src="https://github.com/user-attachments/assets/7be7ff56-b2b6-42b4-b023-6dd16037fbad" />
|:---:|:---:|
Dead|<img width="1327" height="801" alt="스크린샷 2025-10-10 오전 1 51 25" src="https://github.com/user-attachments/assets/23f7debd-1320-41c1-8b8e-1437371f3640" />

