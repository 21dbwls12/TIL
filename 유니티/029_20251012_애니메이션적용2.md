# 애니메이션 적용

## 적 캐릭터

- 기본
- 이동
- 공격
- 피격 죽음

<br>

### 트랜지션

- 사용할 애니메이션을 새로운 컨트롤러에 추가 후 트랜지션 생성
- 모든 트랜지션 전환 영역 수정(플레이어 캐릭터와 같은 순서)  
  <img width="749" height="418" alt="스크린샷 2025-10-12 오후 11 23 06" src="https://github.com/user-attachments/assets/ee746135-996a-436d-92f6-ee48847466bb" />
- 이전 상태가 종료되어야만 전환될 트랜지션 제외 Has Exit Time 체크 해제
- Has Exit Time 체크 해제한 트랜지션 활성화하기 위한 조건 변수 생성  
  <img width="150" height="152" alt="스크린샷 2025-10-12 오후 11 24 56" src="https://github.com/user-attachments/assets/ea3523cf-88a1-45a9-855b-d5e39e4ce853" />
- 위의 트랜지션에 조건 추가해서 활성화
- 조건에 관한 코드 추가 및 수정
  ```C#
  using UnityEngine;
  using UnityEngine.AI;
  using UnityEngine.UI;
  
  public class Enemy : MonoBehaviour
  {
      // 적이 가질 수 있는 상태 목록
      public enum EnemyState
      {
          Idle,    // 기본
          Walk,    // 이동
          Attack,  // 공격
          Damaged, // 피격
          Dead,    // 죽음
      }
  
      // 상태를 담아둘 변수를 만들고, 기본 상태로 시작
      public EnemyState eState = EnemyState.Idle;
  
      // 적의 체력바
      public Slider hpBar;
      // 적의 체력
      public float hp = 100;
  
      // 플레이어
      Transform player;
      // NavMeshAgent 컴포넌트
      NavMeshAgent agent;
      // Animator 컴포넌트
      Animator anim;
      // 플레이어와의 거리
      float distance;
      // 공격 주기를 위한 쿨타임
      // Attack() 함수가 Update() 함수에서 호출되고 있어서 매 프레임마다 애니메이션이 실행됨
      // 1초에 한 번만 공격되도록 직접 조정
      float attackCoolTime;
  
      // 공격 받는 기능
      void Damaged(float damage)
      {
          // 공격 받은 데미지 만큼 체력 감소
          hp -= damage;
  
          // 감소한 체력을 체력바에 표시
          hpBar.value = hp;
  
          // 이동 중단
          agent.isStopped = true;
          // 경로 초기화
          agent.ResetPath();
  
          // 체력이 남아있다면
          if (hp > 0)
          {
              // 피격 애니메이션 실행
              anim.SetTrigger("damaged");
              // 피격 상태로 전환
              eState = EnemyState.Damaged;
          }
          // 체력이 남아있지 않다면
          else
          {
              // 죽음 애니메이션 실행
              anim.SetTrigger("dead");
              // 죽음 상태로 전환
              eState = EnemyState.Dead;
          }
      }
  
      // Start is called once before the first execution of Update after the MonoBehaviour is created
      void Start()
      {
          // Player 컴포넌트로 찾은 플레이어의 Transform 컴포넌트 가져오기
          // 책에서는 FindObjectOfType을 사용했는데 최신 버전은 사용불가라서 경고 뜨기에 경고에 나온 다른 함수로 대체
          player = FindFirstObjectByType<Player>().transform;
  
          // 나의 NavMeshAgent, Animator 컴포넌트 가져오기
          agent = GetComponent<NavMeshAgent>();
          anim = GetComponent<Animator>();
      }
  
      // Update is called once per frame
      void Update()
      {
          // 적과 플레이어 사이의 거리 계산
          distance = Vector3.Distance(transform.position, player.position);
  
          // 이동에 따라 달라지는 NavMeshAgent 컴포넌트의 속도로 애니메이션 전환
          anim.SetFloat("velocity", agent.velocity.magnitude);
  
          // 기본, 이동, 공격 상태일 때 할 일 나누기
          switch (eState)
          {
              case EnemyState.Idle: Idle(); break;
              case EnemyState.Walk: Walk(); break;
              case EnemyState.Attack: Attack(); break;
          }
      }
  
      // 기본 상태일 때 계속 할 일
      void Idle()
      {
          // 플레이어와의 거리가 8 이하라면
          if (distance <= 8)
          {
              // 이동 상태로 전환
              eState = EnemyState.Walk;
              // 이동 시작
              agent.isStopped = false;
          }
      }
  
      // 이동 상태일 때 계속 할 일
      void Walk()
      {
          // 플레이어와의 거리가 8보다 크다면
          if (distance > 8)
          {
              // 기본 상태로 전환
              eState = EnemyState.Idle;
              // 이동 중단
              agent.isStopped = true;
              // 경로 초기화
              agent.ResetPath();
          }
          // 플레이어와의 거리가 2 이하라면
          else if (distance <= 2)
          {
              // 공격 상태로 전환
              eState = EnemyState.Attack;
              // 이동 중단
              agent.isStopped = true;
              // 경로 초기화
              agent.ResetPath();
              // 공격 상태가 되자마자 공격 시작
              attackCoolTime = 1;
          }
          // 다른 상태로 전환하지 않을 때는
          else
          {
              // 플레이어의 위치를 목적지로 설정
              agent.SetDestination(player.position);
          }
      }
  
      // 공격 상태일 때 계속 할 일
      void Attack()
      {
          // 플레이어와의 거리가 2보다 크다면
          if (distance > 2)
          {
              // 이동 상태로 전환
              eState = EnemyState.Walk;
              // 이동 시작
              agent.isStopped = false;
          }
          // 다른 상태로 전환하지 않을 때는
          else
          {
              // 공격 상태일 때 쿨타임 계산
              // deltaTime == 한 프레임의 길이
              attackCoolTime += Time.deltaTime;
  
              // 공격 쿨타임이 1초 이상이 되면
              if (attackCoolTime >= 1)
              {
                  // 공격 애니메이션 실행
                  anim.SetTrigger("attack");
                  // 다시 1초를 셀 수 있게 초기화
                  attackCoolTime = 0;
              }
          }
      }
  }
  ```



https://github.com/user-attachments/assets/51a22347-0833-45ac-a304-ae791ecf6342



https://github.com/user-attachments/assets/c1b5387b-d805-48c2-a328-c43423e3e02d



  
