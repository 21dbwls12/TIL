# 다른 플레이어가 생성한 방에서 상태 동기화

## 참가자의 플레이어 캐릭터 생성

플레이어 캐릭터 생성될 위치 파악 &rarr; Create Empty(PlayerSpawnPoint)

플레이어의 위치 복사|<img width="747" height="366" alt="스크린샷 2025-10-20 오후 4 17 33" src="https://github.com/user-attachments/assets/160c40aa-0cc5-4309-8b98-834c081f1473" />
|:---:|:---:|
PlayerSpawnPoint에 붙여넣기|<img width="764" height="467" alt="스크린샷 2025-10-20 오후 4 18 37" src="https://github.com/user-attachments/assets/f5862d96-e3d0-4737-b2f3-6b19cb4efb2a" />
플레이어 두명이 겹치게 생성되지 않게 복제 후 x값 조절|<img width="168" height="34" alt="스크린샷 2025-10-20 오후 4 21 10" src="https://github.com/user-attachments/assets/5be3c5b7-1fab-469a-9adf-212f07afde22" />
플레이어 오브젝트 프리팹화(Prefabs 폴더 말고 Resources 폴더)|<img width="225" height="63" alt="스크린샷 2025-10-20 오후 4 24 39" src="https://github.com/user-attachments/assets/6a679ad8-2028-45b6-88a2-a5f78223a7b5" />

방에 참가한 플레이어 관리를 위한 오브젝트 생성
- Create Empty(PlaySceneManager) &rarr; PlaySceneManager 스크립트 컴포넌트로 추가

PlaySceneManager 스크립트|
|:---:|

```C#
using Photon.Pun;
using UnityEngine;

public class PlaySceneManager : MonoBehaviour
{
    // 플레이어 스폰 위치
    public Transform[] playerSpawnPoints;

    // Start is called once before the first execution of Update after the MonoBehaviour is created
    void Start()
    {
        // 현재 방에 참여한 플레이어 인원
        int playerCount = PhotonNetwork.CurrentRoom.PlayerCount;

        // 플레이어 인원에 따라 다른 스폰 위치에 플레잉어 생성(1명이면 0번, 2명이면 1번)
        // 프리팹을 복제하여 생성함과 동시에 네트워크에서 동기화
        // 항상 Resources 폴더를 경로로 사용하므로 Player 오브젝트를 프리팹화할 때 Prefabs 폴더가 아닌 Resources 폴더에 넣었던 것
        // 복제할 오브젝트에 PhotonView 컴포넌트가 부여되어 있어야 함(동기화 담당 및 고유 ID 배정)
        PhotonNetwork.Instantiate("Player", playerSpawnPoints[playerCount - 1].position, Quaternion.identity);    
    }
}
```

<img width="502" height="144" alt="스크린샷 2025-10-20 오후 4 39 38" src="https://github.com/user-attachments/assets/9cb10160-f69d-4643-bbbc-e1e8249f727c" />|<img width="747" height="314" alt="스크린샷 2025-10-20 오후 4 40 07" src="https://github.com/user-attachments/assets/91f8c677-c582-4a7e-8eb1-79455ae90f3a" />
|:---:|:---:|

Player 스크립트|
|:---:|

```C#
// 플레이어가 생성되자마자 땅과 충돌해서 Start() 함수보다 OnCollisionEnter() 함수가 먼저 호출
// Start() -> Awake()(항상 제일 먼저 호출)
void Awake()
{
    // 플레이어의 Rigidbody, Animator 컴포넌트 가져와서 저장
    rb = GetComponent<Rigidbody>();
    anim = GetComponent<Animator>();
}
```

## 자신의 캐릭터만 제어

현재는 같은 스크립트로 모든 플레이어 오브젝트가 적용되기 때문에 플레이어 캐릭터 2개가 동시에 작동

각각의 컴퓨터에서 보이는 캐릭터가 2개씩 &rarr; 4개의 플레이어 오브젝트

