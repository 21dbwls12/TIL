# 총알이 없는 슈팅

1. [조준점 생성](#조준점-생성)
2. 마우스 왼쪽 클릭 감지
3. [눈에 보이지 않는 슈팅 기능](#눈에-보이지-않는-슈팅-구현)
4. [총에 맞은 효과 제작](#총에-맞은-효과-제작)
5. [총에 맞은 부위에 효과 생성](#총에-맞은-순간-생성-프리팹-형태로-저장)

<br>

## 조준점 생성

- 화면 중앙
- 카메라가 움직여도 항상 화면 가운데에 고정이 되어야 함
  - 화면에 붙어 있는 UI로 만드는 것 권장
- UI &rarr; Image(Crosshair)

Canvas 컴포넌트의 Scaler의 해상도 수정|
|:---:|
<img width="458" height="122" alt="스크린샷 2025-10-08 오후 10 59 43" src="https://github.com/user-attachments/assets/b9841f80-3e9c-4978-8a0f-7ff5d4860d68" />|

Crosshair 수정(조준점)|구현된 실제 화면|
|:---:|:---:|
<img width="460" height="406" alt="스크린샷 2025-10-08 오후 11 02 06" src="https://github.com/user-attachments/assets/327ccd47-2250-4c8a-9296-5081fc0e4789" />|<img width="586" height="491" alt="스크린샷 2025-10-08 오후 11 03 03" src="https://github.com/user-attachments/assets/ab6446ef-3a9e-41aa-acfc-ff319e62b978" />

<br>

## 눈에 보이지 않는 슈팅 구현

- 조준점에서 보이지 않는 레이저가 발사되도록 코드 작성 필요
  - `Ray` 자료형 사용
  - Ray(레이저)를 생성해 발사한 후 Ray에 맞은 오브젝트의 이름을 출력하는 코드

```C#
using UnityEngine;

public class PlayerFire : MonoBehaviour
{
    // 총알 프리팹을 담아둘 변수
    public GameObject bulletPref;

    // 총알 발사하는 힘
    public float firePower;

    // Start is called once before the first execution of Update after the MonoBehaviour is created
    void Start()
    {
        // 마우스 커서 안 보이게
        Cursor.visible = false;

        // 마우스 커서가 게임 화면을 벗어나지 못하도록 잠금
        Cursor.lockState = CursorLockMode.Confined;
    }

    // Update is called once per frame
    void Update()
    {
        // 마우스 좌클릭을 누르는 순간
        if (Input.GetMouseButtonDown(0))
        {
            // 화면 가운데에서 시작하는 Ray 생성
            Ray ray = Camera.main.ViewportPointToRay(new Vector2(0.5f, 0.5f));

            // Ray에 맞은 물체를 담아둘 변수
            RaycastHit hit;

            // Ray를 발사하고, Ray에 맞은 물체는 hit에 저장
            Physics.Raycast(ray, out hit);

            // 맞은 물제의 이름 출력
            print(hit.transform.name);
        }
    }
}
```

- `Camera.main`
  - MainCamera 태그를 가진 오브젝트의 Camera 컴포넌트 가져오기
- `ViewportPointToRay()`
  - Viewport
    - 게임화면
    - 왼쪽 하단 &rarr; (0, 0)
    - 오른쪽 상단 &rarr; (1, 1)
    - 중앙 &rarr; (0.5f, 0.5f)
  - PointToRay
    - 게임화면의 특정 좌표에서 시작하는 Ray를 생성
  - `ScreenPointToRay()`
    - Screen
      - 해상도 크기 기반
      - 왼쪽 하단 &rarr; (0, 0)
      - 오른쪽 상단 &rarr; (해상도 가로 길이, 해상도 세로 길이)
      - 중앙(1920x1080) &rarr; (960. 540)
- `Vector2`
  - 게임 화면은 가로와 세로만 존재 &rarr; `Vector2`로 설정
  - `Vector3` 자리에 할당하면 Z축은 자동으로 0
- `Physics.Raycast`
  - Ray를 발사하고 발사된 Ray에 맞은 오브젝트를 RaycastHit 자료형으로 반환
  - 물리 작용 이용(Physics 클래스의 함수) &rarr; Collider 컴포넌트가 있는 오브젝트만 Ray와 충돌 가능
  - RaycastHit
    - 바로 접근할 수 있는 컴포넌트; Transform, Rigidbody, Collider
    - 위 3개의 컴포넌트를 먼저 거쳐야 컴포넌트에 접근하거나 사용 가능

땅을 조준했을 때 "Ground" 출력|땅 이외에 다른 곳 조준했을 때 NullReference 에러 발생|
|:---:|:---:|
<img width="588" height="517" alt="스크린샷 2025-10-09 오전 1 35 29" src="https://github.com/user-attachments/assets/9b3c03a8-a81a-411b-8a9a-83a542bee16f" />|<img width="583" height="520" alt="스크린샷 2025-10-09 오전 1 36 12" src="https://github.com/user-attachments/assets/fa8e5684-1238-4278-bf8f-370a20814194" />

<br>

### 맞은 오브젝트만 있을 때만 태그 출력

```C#
using UnityEngine;

public class PlayerFire : MonoBehaviour
{
    // 총알 프리팹을 담아둘 변수
    public GameObject bulletPref;

    // 총알 발사하는 힘
    public float firePower;

    // Start is called once before the first execution of Update after the MonoBehaviour is created
    void Start()
    {
        // 마우스 커서 안 보이게
        Cursor.visible = false;

        // 마우스 커서가 게임 화면을 벗어나지 못하도록 잠금
        Cursor.lockState = CursorLockMode.Confined;
    }

    // Update is called once per frame
    void Update()
    {
        // 마우스 좌클릭을 누르는 순간
        if (Input.GetMouseButtonDown(0))
        {
            // 화면 가운데에서 시작하는 Ray 생성
            Ray ray = Camera.main.ViewportPointToRay(new Vector2(0.5f, 0.5f));

            // Ray에 맞은 물체를 담아둘 변수
            RaycastHit hit;

            // Ray를 발사하고, Ray에 맞은 물체는 hit에 저장
            // 맞은 물체가 있을 때만
            if (Physics.Raycast(ray, out hit))
            {
                // 맞은 물제의 이름 출력
                print(hit.transform.name);
            }

        }
    }
}
```

맞은 오브젝트가 없을 때 발생하는 NullReference 더 이상 출력되지 않음

<br>

## 총에 맞은 효과 제작

- 화면에 고정되어 사용자와 상호작용할 이미지가 아니라서 2D 오브젝트 사용
  - 2D Object &rarr; Sprites &rarr; Square(ShootEffect)
- 총에 맞은 순간 생성 &rarr; 프리팹 형태로 저장

```C#
using UnityEngine;

public class PlayerFire : MonoBehaviour
{
    // 총 효과 프리팹을 담아둘 변수
    public GameObject shootEffectPref;

    // Start is called once before the first execution of Update after the MonoBehaviour is created
    void Start()
    {
        // 마우스 커서 안 보이게
        Cursor.visible = false;

        // 마우스 커서가 게임 화면을 벗어나지 못하도록 잠금
        Cursor.lockState = CursorLockMode.Confined;
    }

    // Update is called once per frame
    void Update()
    {
        // 마우스 좌클릭을 누르는 순간
        if (Input.GetMouseButtonDown(0))
        {
            // 화면 가운데에서 시작하는 Ray 생성
            Ray ray = Camera.main.ViewportPointToRay(new Vector2(0.5f, 0.5f));

            // Ray에 맞은 물체를 담아둘 변수
            RaycastHit hit;

            // Ray를 발사하고, Ray에 맞은 물체는 hit에 저장
            // 맞은 물체가 있을 때만
            if (Physics.Raycast(ray, out hit))
            {
                // // 맞은 물제의 이름 출력
                // print(hit.transform.name);

                // 맞은 위치에, 맞은 표면의 수직이 되는 각도로 총 효과 프리팹의 복사본 생성
                Instantiate(shootEffectPref, hit.point, Quaternion.LookRotation(hit.normal));
            }

        }
    }
}
```

- `hit.point`
  - Ray와 오브젝트가 충돌한 지점 정확히 파악하기 위해 사용
  - `hit.tranform.position`
    - 맞은 오브젝트의 위치 정보라서 총에 맞은 오브젝트의 중심에 생성
- `hit.normal`
  - Ray와 오브젝트가 충돌한 지점의 법선 각도
    - 법선 각도란 곡면 위에 접평면에 대해 수직이 되는 선의 각도
  - Ray에 맞은 표면의 굴곡에 맞게 각도 설정하기 위해 사용
  - 방향을 나타내는 `Vector3` (회전각도 X)
    - Ray가 바닥과 충돌하면 바닥과 수직이 되는 각도는 위를 향하고 `hit.normal`의 값은 `Vector3(0, 1, 0)`
- `Quaternion.LookRotation()`
  - 방향을 기준으로 회전
  - `Quaternion.Euler()` &rarr; 방향이 아닌 회전각으로 반환하므로 Y축을 기준으로 1도 회전

https://github.com/user-attachments/assets/5ba4b69f-fb40-4370-a364-1f10db5240b5

<br>

### 효과 이미지가 깜빡거리는 오류 발생

Ray와 오브젝트가 충돌한 표면에 효과 이미지가 생성되었기 때문에 카메라가 충돌한 오브젝트와 효과 이미지 중 무엇을 먼저 랜더링 할지 결정하지 못하는 상태
- 효과 이미지를 법선 각도의 방향으로 조금만 이동

```C#
using UnityEngine;

public class PlayerFire : MonoBehaviour
{
    // 총 효과 프리팹을 담아둘 변수
    public GameObject shootEffectPref;

    // Start is called once before the first execution of Update after the MonoBehaviour is created
    void Start()
    {
        // 마우스 커서 안 보이게
        Cursor.visible = false;

        // 마우스 커서가 게임 화면을 벗어나지 못하도록 잠금
        Cursor.lockState = CursorLockMode.Confined;
    }

    // Update is called once per frame
    void Update()
    {
        // 마우스 좌클릭을 누르는 순간
        if (Input.GetMouseButtonDown(0))
        {
            // 화면 가운데에서 시작하는 Ray 생성
            Ray ray = Camera.main.ViewportPointToRay(new Vector2(0.5f, 0.5f));

            // Ray에 맞은 물체를 담아둘 변수
            RaycastHit hit;

            // Ray를 발사하고, Ray에 맞은 물체는 hit에 저장
            // 맞은 물체가 있을 때만
            if (Physics.Raycast(ray, out hit))
            {
                // // 맞은 물제의 이름 출력
                // print(hit.transform.name);

                // 맞은 위치에, 맞은 표면의 수직이 되는 각도로 총 효과 프리팹의 복사본 생성
                GameObject shootEffect = Instantiate(shootEffectPref, hit.point + hit.normal * 0.01f, Quaternion.LookRotation(hit.normal));

                // 총알 자국을 맞은 오브젝트의 자식으로 설정
                shootEffect.transform.SetParent(hit.transform);
            }

        }
    }
}
```

더 이상 깜빡거리지 않는 충돌 효과|충돌한 오브젝트의 자식으로 생성된 효과 프리팹
|:---:|:---:|
<img width="586" height="495" alt="스크린샷 2025-10-09 오전 2 56 38" src="https://github.com/user-attachments/assets/c54af2bb-27d7-4d15-b7be-6d95267a9004" />|<img width="190" height="115" alt="스크린샷 2025-10-09 오전 2 56 54" src="https://github.com/user-attachments/assets/2ba64065-b823-42b6-8ec7-92f4719d85a6" />
